/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[19],{254:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(154);function i(e,t,a){const i=["kuery"===t.language?Object(n.f)(Object(n.d)(t.query)):Object(n.e)(t.query)],c=[];for(const t of e){if(t.meta.disabled||void 0!==a&&t.meta.controlledBy===a)continue;const{meta:{negate:e,type:n,key:s}}=t;let o=t.query;void 0===o&&"exists"===n&&(o={exists:{field:s}}),o&&(e?c.push(o):i.push(o))}return{bool:{must:i,must_not:c}}}},255:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(23),i=a(25),c=a(8),s=a(26);function o(e,t,a){return e.pipe(Object(i.pluck)("jobIds"),Object(i.distinctUntilChanged)(c.isEqual),Object(i.switchMap)((e=>t.getJobs$(e))),Object(i.map)((e=>e.map((e=>{const t=Object(s.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!0,bucketSpanSeconds:t.asSeconds()}})))),Object(i.catchError)((e=>{var t;return a(null!==(t=e.body)&&void 0!==t?t:e),Object(n.of)(void 0)})))}},821:function(e,t,a){"use strict";a.r(t),a.d(t,"EmbeddableSwimLaneContainer",(function(){return f}));var n=a(15),i=a(40),c=a(41),s=a(23),o=a(25),r=a(101),b=a(78),l=a(43),u=a(156),d=a(45),j=a(254),O=a(37),m=a(255);var p=a(169),g=a(11);const f=({id:e,embeddableContext:t,embeddableInput:a,services:f,refresh:v,onInputChange:S,onOutputChange:w})=>{const[y,h]=Object(n.useState)(0),[E,M]=Object(n.useState)(1),[{},{uiActions:_}]=f,[T,x]=Object(n.useState)(),[I,k,C,A,L,P,R]=function(e,t,a,i,c,p){const[{uiSettings:g},,{anomalyTimelineService:f,anomalyDetectorService:v}]=i,[S,w]=Object(n.useState)(),[y,h]=Object(n.useState)(),[E,M]=Object(n.useState)(),[_,T]=Object(n.useState)(),[x,I]=Object(n.useState)(!1),k=Object(n.useMemo)((()=>new s.Subject),[]),C=Object(n.useMemo)((()=>Object(m.a)(e,v,M).pipe(Object(o.shareReplay)(1))),[]),A=Object(n.useMemo)((()=>Object(s.combineLatest)([C,k,e.pipe(Object(o.pluck)("timeRange"))]).pipe(Object(o.skipWhile)((([e,t])=>!Array.isArray(e)||!t)),Object(o.tap)((([,,e])=>{f.setTimeRange(e)})),Object(o.map)((([e,t])=>f.getSwimlaneBucketInterval(e,t))),Object(o.distinctUntilChanged)(((e,t)=>e.asSeconds()===t.asSeconds())))),[]),L=Object(n.useMemo)((()=>new s.Subject),[]),P=Object(n.useMemo)((()=>new s.Subject),[]),R=Object(n.useMemo)((()=>new r.a({"histogram:maxBars":g.get(l.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":g.get(l.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:g.get("dateFormat"),"dateFormat:scaled":g.get("dateFormat:scaled")})),[]);return Object(n.useEffect)((()=>{const n=Object(s.combineLatest)([C,e,A,L,P.pipe(Object(o.startWith)(void 0),Object(o.distinctUntilChanged)(((e,t)=>void 0===e&&t===b.i))),a.pipe(Object(o.startWith)(null))]).pipe(Object(o.tap)(I.bind(null,!0)),Object(o.debounceTime)(500),Object(o.switchMap)((([e,a,n,i,c])=>{if(!e)return Object(s.of)(void 0);const{viewBy:r,swimlaneType:l,perPage:m,filters:p,query:g,viewMode:v}=a;let w;y||h(l);try{w=Object(j.a)(p,g,O.CONTROLLED_BY_SWIM_LANE_FILTER)}catch(e){return M(e),Object(s.of)(void 0)}return Object(s.from)(f.loadOverallData(e,void 0,n)).pipe(Object(o.switchMap)((a=>{const{earliest:j,latest:O}=a;var p;return a&&l===b.h.VIEW_BY?(void 0===c&&T(null!=m?m:b.i),v===d.ViewMode.EDIT&&c!==m&&t({perPage:c}),Object(s.from)(f.loadViewBySwimlane([],{earliest:j,latest:O},e,r,Object(u.c)(S)?S.cardinality:b.a,null!==(p=null!=c?c:m)&&void 0!==p?p:b.i,i,void 0,w,n)).pipe(Object(o.map)((e=>({...e,earliest:j,latest:O}))))):Object(s.of)(a)})))})),Object(o.catchError)((e=>(M(e.body),Object(s.of)(void 0))))).subscribe((e=>{void 0!==e&&(M(null),w(e),I(!1))}));return()=>{n.unsubscribe()}}),[]),Object(n.useEffect)((()=>{L.next(p)}),[p]),Object(n.useEffect)((()=>{void 0!==_&&P.next(_)}),[_]),Object(n.useEffect)((()=>{k.next(c)}),[c]),[y,S,null!=_?_:b.i,T,R,x,E]}(a,S,v,f,y,E);Object(n.useEffect)((()=>{w({perPage:C,fromPage:E,interval:null==k?void 0:k.interval})}),[C,E,k]);const B=Object(n.useCallback)((e=>{x(e),e&&_.getTrigger(p.a).exec({embeddable:t,data:e,updateCallback:x.bind(null,void 0)})}),[k,C,E,x]);return R?Object(g.jsx)(i.EuiCallOut,{title:Object(g.jsx)(c.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.errorMessage",defaultMessage:"Unable to load the ML swim lane data"}),color:"danger",iconType:"alert",style:{width:"100%"}},Object(g.jsx)("p",null,R.message)):Object(g.jsx)("div",{style:{width:"100%",padding:"8px"},"data-test-subj":"mlAnomalySwimlaneEmbeddableWrapper"},Object(g.jsx)(u.b,{id:e,"data-test-subj":`mlSwimLaneEmbeddable_${t.id}`,timeBuckets:L,swimlaneData:k,swimlaneType:I,fromPage:E,perPage:C,swimlaneLimit:Object(u.c)(k)?k.cardinality:void 0,onResize:h,selection:T,onCellsSelection:B,onPaginationChange:e=>{e.fromPage&&M(e.fromPage),e.perPage&&(M(1),A(e.perPage))},isLoading:P,noDataWarning:Object(g.jsx)(c.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.noDataFound",defaultMessage:"No anomalies found"})}))};t.default=f}}]);
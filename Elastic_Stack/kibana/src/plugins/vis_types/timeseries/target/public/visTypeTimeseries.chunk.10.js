(window.visTypeTimeseries_bundle_jsonpfunction=window.visTypeTimeseries_bundle_jsonpfunction||[]).push([[10],{249:function(e,t,i){e.exports=i(19)(7)},297:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return vis_TimeseriesVisualization}));var s=i(16),o=i.n(s),a=i(4),r=i(8),n=i(13),c=i(29),l=i(59),d=i(52),u=i(60),m=i(2);var p=i(30),g=i.n(p),b=i(64),h=i(18),y=i(0),f=i(44);const T="#000";var x=i(249),v=i.n(x);const k={seriesId:v.a.string.isRequired,seriesGroupId:v.a.string.isRequired,name:v.a.string.isRequired,data:v.a.arrayOf(v.a.arrayOf(v.a.number)).isRequired,hideInLegend:v.a.bool.isRequired,color:v.a.string.isRequired,stackMode:v.a.oneOf(["percentage","wiggle","silhouette"]),stackAccessors:v.a.arrayOf(v.a.number),xScaleType:v.a.string,yScaleType:v.a.string,timeZone:v.a.string.isRequired,enableHistogramMode:v.a.bool.isRequired,sortIndex:v.a.number};v.a.shape({fill:v.a.number,lineWidth:v.a.number,show:v.a.boolean}).isRequired,v.a.shape({fill:v.a.number,lineWidth:v.a.number,show:v.a.bool,steps:v.a.oneOfType([v.a.number,v.a.bool])}).isRequired,v.a.shape({lineWidth:v.a.number,radius:v.a.number,show:v.a.bool}).isRequired;var A=i(1);function S({seriesId:e,seriesGroupId:t,name:i,data:s,hideInLegend:o,lines:a,color:r,stackAccessors:n,stackMode:l,points:d,xScaleType:u,yScaleType:m,timeZone:p,enableHistogramMode:g,sortIndex:b,y1AccessorFormat:h,y0AccessorFormat:y,tickFormat:x}){const v=e,k=t,S=(({points:e,lines:t,color:i})=>({areaSeriesStyle:{line:{stroke:i,strokeWidth:Number(t.lineWidth)||0,visible:Boolean(t.show&&t.lineWidth)},area:{fill:i,opacity:t.fill<=0?0:t.fill,visible:Boolean(t.show)},point:{radius:e.radius||.5,stroke:i||T,strokeWidth:e.lineWidth||5,visible:e.lineWidth>0&&Boolean(e.show)}},curve:t.steps?c.CurveType.CURVE_STEP:c.CurveType.LINEAR}))({points:d,lines:a,color:r}),_={id:v,name:i,groupId:k,data:s,color:r,hideInLegend:o,xAccessor:f.e,yAccessors:f.g,y0Accessors:"band"===a.mode?f.f:void 0,y1AccessorFormat:h,y0AccessorFormat:y,stackAccessors:n,stackMode:l,xScaleType:u,yScaleType:m,timeZone:p,enableHistogramMode:g,sortIndex:b,tickFormat:x,...S};return g&&(_.histogramModeAlignment="center"),Object(A.jsx)(c.AreaSeries,_)}function _({seriesId:e,seriesGroupId:t,name:i,data:s,hideInLegend:o,bars:a,color:r,stackAccessors:n,stackMode:l,xScaleType:d,yScaleType:u,timeZone:m,enableHistogramMode:p,sortIndex:g,y1AccessorFormat:b,y0AccessorFormat:h,tickFormat:y}){const x=e,v=t,k=(({show:e=!0,lineWidth:t=0,fill:i=1},s)=>({barSeriesStyle:{rectBorder:{stroke:s||T,strokeWidth:t,visible:e},rect:{fill:s||T,opacity:i}}}))(a,r),S={id:x,name:i,groupId:v,data:s,color:r,hideInLegend:o,xAccessor:f.e,yAccessors:f.g,y0Accessors:"band"===a.mode?f.f:void 0,y1AccessorFormat:b,y0AccessorFormat:h,stackAccessors:n,stackMode:l,xScaleType:d,yScaleType:u,timeZone:m,enableHistogramMode:p,sortIndex:g,tickFormat:y,...k};return p&&(S.histogramModeAlignment="center"),Object(A.jsx)(c.BarSeries,S)}S.defaultProps={yScaleType:c.ScaleType.Linear,xScaleType:c.ScaleType.Time},_.defaultProps={yScaleType:c.ScaleType.Linear,xScaleType:c.ScaleType.Time};var j=i(55),F=i.n(j);function O(e){return F()(e).luminosity()}function I(e,t){return F()(e).contrast(F()(t))}function E(e,t,i=7){return function(e){const t=Math.round(255*e);return`rgb(${t},${t},${t})`}(function(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}(function(e,t,i=7){const s=O(e);return s>O(t)?(s+.05-.05*i)/i:Math.min(i*(s+.05)-.05,1)}(e,t,i)))}function w(e,t){if(!function(e){if("string"!=typeof e)return!1;if(0===e.length)return!1;try{return F()(e),!0}catch{return!1}}(t))return e;const i=O(t)<=.179?c.DARK_THEME:c.LIGHT_THEME,s=function(e,t,i,s=4.5){const o=I(e,t),a=I(e,i);return o>=a?o>=s?t:E(e,t,s):a>=s?i:E(e,i,s)}(t,c.LIGHT_THEME.axes.axisTitle.fill,c.DARK_THEME.axes.axisTitle.fill);return{...i,axes:{...i.axes,axisTitle:{...i.axes.axisTitle,fill:s},tickLabel:{...i.axes.tickLabel,fill:s},axisLine:{...i.axes.axisLine,stroke:s},tickLine:{...i.axes.tickLine,stroke:s}}}}var L=i(42),C=i(74),B=i(36),D=i(66),M=i(7);function N(e){if(!e)return"";const t=Object(D.a)(e);return t?M.i18n.translate("visTypeTimeseries.axisLabelOptions.axisLabel",{defaultMessage:"per {unitValue} {unitString}",values:{unitValue:t.unitValue,unitString:t.unitString}}):void 0}const V=({backgroundColor:e,showGrid:t,legend:i,legendPosition:s,truncateLegend:o,maxLegendLines:r,tooltipMode:l,series:d,yAxis:u,onBrush:p,onFilterClick:T,xAxisFormatter:x,annotations:v,syncColors:k,palettesService:j,interval:F,isLastBucketDropped:I})=>{var E,D;const{theme:M,activeCursor:V}=Object(y.a)(),R=Object(a.useRef)(),P=M.useChartsTheme(),H=Object(B.useActiveCursor)(V,R,{isDateHistogram:!0}),G=Object(a.useMemo)((()=>(null!=v?v:[]).some((e=>{var t;return Boolean(null===(t=e.data)||void 0===t?void 0:t.length)}))),[v]);let W=(z=x,({value:e})=>z(e));var z;if(!I){const e=(e=>{var t;const i=(null===(t=e[0])||void 0===t?void 0:t.data)||[];return null!=i&&i.length?{domainStart:i[0][0],domainEnd:i[Math.max(i.length-1,0)][0]}:void 0})(d);W=Object(B.renderEndzoneTooltip)(F,null==e?void 0:e.domainStart,null==e?void 0:e.domainEnd,x)}const q=Object(y.f)(),$=Object(h.a)(q),Z=d.some((({bars:e})=>null==e?void 0:e.show)),U=g()(function(e){if("string"!=typeof e)return;return O(e)<=.179?"tvbVisTimeSeriesDark":"tvbVisTimeSeriesLight"}(e)),Y=w(M.useChartsBaseTheme(),e),K=Object(a.useCallback)(((e,t,i)=>{const s=d.filter((e=>e.seriesId===t)),o={seriesById:s,seriesName:e,seriesId:i,baseColor:s[0].baseColor,seriesPalette:s[0].palette,palettesRegistry:j,syncColors:k};return Object(C.a)(o)||null}),[j,d,k]);return Object(A.jsx)(c.Chart,{ref:R,renderer:"canvas",className:U},Object(A.jsx)(c.Settings,{debugState:null!==(E=window._echDebugStateFlag)&&void 0!==E&&E,showLegend:i,showLegendExtra:!0,allowBrushingLastHistogramBin:!0,legendPosition:s,onBrushEnd:({x:e})=>{if(!e)return;const[t,i]=e;p(t,i,d)},onElementClick:e=>{T(d,e)},animateData:!1,onPointerUpdate:H,theme:[{axes:{tickLabel:{padding:{inner:G?19:P.axes.tickLabel.padding.inner}}}},Z?{}:{crosshair:{band:{fill:"#F00"}}},{background:{color:e},legend:{labelOptions:{maxLines:o?null!=r?r:1:0}}},P],baseTheme:Y,tooltip:{snap:!0,type:l===m.h.SHOW_FOCUSED?c.TooltipType.Follow:c.TooltipType.VerticalCursor,boundary:null!==(D=document.getElementById("app-fixed-viewport"))&&void 0!==D?D:void 0,headerFormatter:W},externalPointerEvents:{tooltip:{visible:!1}}}),v.map((({id:e,data:t,icon:i,color:s})=>{const o=((e,t)=>e.map((({key:e,docs:i})=>({dataValue:e,details:i[0],header:t({value:e})}))))(t,W),a={line:{stroke:s}};return Object(A.jsx)(c.LineAnnotation,{key:e,id:e,domainType:c.AnnotationDomainType.XDomain,dataValues:o,marker:Object(A.jsx)(n.EuiIcon,{type:f.b[i]||"asterisk"}),hideLinesTooltips:!0,style:a})})),d.map((({id:e,seriesId:t,label:i,labelFormatted:s,bars:o,lines:a,data:r,hideInLegend:n,truncateLegend:l,xScaleType:d,yScaleType:u,groupId:m,color:p,isSplitByTerms:g,stack:h,points:y,y1AccessorFormat:T,y0AccessorFormat:x,tickFormat:v},k)=>{const j=(e=>{switch(e){case f.c.STACKED:case f.c.STACKED_WITHIN_SERIES:case f.c.PERCENT:return f.d;default:return}})(h),F=h===f.c.PERCENT,O=h!==f.c.NONE,I=`${e}-${i}`;let E=i.toString();s&&(E=Object(b.a)(s));const w=K(E,t,e),C=g&&w?w:p;return null!=o&&o.show?Object(A.jsx)(_,{key:I,seriesId:e,seriesGroupId:m,name:Object(L.b)(E),data:r,hideInLegend:n,truncateLegend:l,bars:o,color:C,stackAccessors:j,stackMode:F?c.StackMode.Percentage:void 0,xScaleType:d,yScaleType:u,timeZone:$,enableHistogramMode:O,sortIndex:k,y1AccessorFormat:T,y0AccessorFormat:x,tickFormat:v}):null!=a&&a.show?Object(A.jsx)(S,{key:I,seriesId:e,seriesGroupId:m,name:Object(L.b)(E),data:r,hideInLegend:n,truncateLegend:l,lines:a,color:C,stackAccessors:j,stackMode:F?c.StackMode.Percentage:void 0,points:y,xScaleType:d,yScaleType:u,timeZone:$,enableHistogramMode:O,sortIndex:k,y1AccessorFormat:T,y0AccessorFormat:x,tickFormat:v}):null})),u.map((({id:e,groupId:i,position:s,tickFormatter:o,domain:a,hide:r})=>Object(A.jsx)(c.Axis,{key:i,groupId:i,id:e,position:s,domain:a,hide:r,gridLine:{...f.a,visible:t},tickFormat:o}))),Object(A.jsx)(c.Axis,{id:"bottom",position:c.Position.Bottom,title:N(F),tickFormat:x,gridLine:{...f.a,visible:t}}))};V.defaultProps={showGrid:!0,legend:!0,legendPosition:"right"};var R=i(26),P=i(61),H=i(131);class vis_TimeseriesVisualization extends a.Component{constructor(...e){super(...e),o()(this,"scaledDataFormat",this.props.getConfig("dateFormat:scaled")),o()(this,"dateFormat",this.props.getConfig("dateFormat")),o()(this,"yAxisIdGenerator",Object(n.htmlIdGenerator)("yaxis")),o()(this,"xAxisFormatter",(e=>{const t=Object(H.a)(e,this.scaledDataFormat,this.dateFormat,this.props.model.ignore_daylight_time);return e=>t(e)})),o()(this,"yAxisStackedByPercentFormatter",(e=>{const t=100*Number(e);return`${(Number.isNaN(t)?0:t).toFixed(0)}%`})),o()(this,"applyDocTo",(e=>t=>{const{fieldFormatMap:i}=this.props;Object.keys(t).forEach((e=>{if(null!=i&&i[e]){const s=Object(u.a)(e,i);t[e]=s(t[e])}}));const s=Object(P.a)(e,null,t,{noEscape:!0});return s instanceof Error?(this.showToastNotification=s.error.caused_by,e):s})),o()(this,"prepareAnnotations",(()=>{const{model:e,visData:t}=this.props;return Object(r.map)(e.annotations,(({id:i,color:s,icon:o,template:a})=>{const n=Object(r.get)(t,`${e.id}.annotations.${i}`,[]),c=this.applyDocTo(a);return{id:i,color:s,icon:o,data:n.map((({docs:e,...t})=>({...t,docs:e.map(c)})))}}))}))}componentDidUpdate(){const e=Object(y.b)().notifications.toasts;this.showToastNotification&&this.notificationReason!==this.showToastNotification.reason&&(this.notification&&e.remove(this.notification),this.notificationReason=this.showToastNotification.reason,this.notification=e.addDanger({title:this.showToastNotification.title,text:Object(A.jsx)(R.MarkdownSimple,null,this.showToastNotification.reason)})),!this.showToastNotification&&this.notification&&(e.remove(this.notification),this.notificationReason=null,this.notification=null)}render(){const{model:e,visData:t,onBrush:i,onFilterClick:s,syncColors:o,palettesService:a,fieldFormatMap:n,getConfig:c}=this.props,d=Object(r.get)(t,`${e.id}.series`,[]),p=Object(D.b)(t,e),g=this.yAxisIdGenerator("main_group"),b=e.series.filter((e=>!e.hidden)).map((e=>Object(r.cloneDeep)(e))),h=vis_TimeseriesVisualization.getAxisScaleType(e),y=vis_TimeseriesVisualization.getYAxisDomain(e),T=[];let x=!1;return this.showToastNotification=null,b.forEach((t=>{var i;const s=t.stacked===f.c.STACKED_WITHIN_SERIES,o=Boolean(t.separate_axis),a=o||s?t.id:g,p=o?vis_TimeseriesVisualization.getYAxisDomain(t):void 0,v=a!==g,k=t.formatter===m.b.DEFAULT?Object(u.a)(Object(l.a)(t.metrics),n):vis_TimeseriesVisualization.getTickFormatter(t,c),A={...t.palette,name:"kibana"===t.split_color_mode?"kibana_palette":t.split_color_mode||(null===(i=t.palette)||void 0===i?void 0:i.name)},S=o?vis_TimeseriesVisualization.getAxisScaleType(t):h;if(t.stacked===f.c.PERCENT&&(t.separate_axis=!0,t.axisFormatter="percent",t.axis_min=t.axis_min||0,t.axis_max=t.axis_max||1,t.axis_position=e.axis_position),d.filter((e=>Object(r.startsWith)(e.id,t.id))).forEach((e=>{e.tickFormat=k,e.groupId=a,e.yScaleType=S,e.hideInLegend=Boolean(t.hide_in_legend),e.palette=A,e.baseColor=t.color,e.isSplitByTerms="terms"===t.split_mode})),v)vis_TimeseriesVisualization.addYAxis(T,{domain:p,groupId:a,id:this.yAxisIdGenerator(t.id),position:t.axis_position,hide:s,tickFormatter:t.stacked===f.c.PERCENT?this.yAxisStackedByPercentFormatter:k});else if(!x){const t=((e,t)=>e.every((e=>e.formatter===m.b.DEFAULT))&&t?e.map((({metrics:e})=>{var i,s;return t[null!==(i=null===(s=Object(r.last)(e))||void 0===s?void 0:s.field)&&void 0!==i?i:""]})).every(((e,t,[i])=>Object(r.isEqual)(e,i))):e.every((t=>t.formatter===e[0].formatter&&t.value_template===e[0].value_template)))(b,n)?k:e=>e;vis_TimeseriesVisualization.addYAxis(T,{tickFormatter:t,id:this.yAxisIdGenerator("main"),groupId:g,position:e.axis_position,domain:y}),x=!0}})),Object(A.jsx)("div",{className:"tvbVis"},Object(A.jsx)("div",{className:"tvbVisTimeSeries"},Object(A.jsx)(V,{series:d,yAxis:T,onBrush:i,onFilterClick:s,backgroundColor:e.background_color,showGrid:Boolean(e.show_grid),legend:Boolean(e.show_legend),legendPosition:e.legend_position,truncateLegend:Boolean(e.truncate_legend),maxLegendLines:e.max_lines_legend,tooltipMode:e.tooltip_mode,xAxisFormatter:this.xAxisFormatter(p),annotations:this.prepareAnnotations(),syncColors:o,palettesService:a,interval:p,isLastBucketDropped:Boolean(e.drop_last_bucket||e.series.some((e=>e.series_drop_last_bucket)))})))}}o()(vis_TimeseriesVisualization,"getYAxisDomain",(e=>{const t=Object(r.get)(e,"axis_min","").toString(),i=Object(r.get)(e,"axis_max","").toString(),s=e.series?e.series.filter((({hidden:e})=>!e)).every((({fill:e})=>"0"===e)):"0"===e.fill;return{min:t.length?Number(t):void 0,max:i.length?Number(i):void 0,fit:s}})),o()(vis_TimeseriesVisualization,"addYAxis",((e,{id:t,groupId:i,position:s,tickFormatter:o,domain:a,hide:r})=>{e.push({id:t,groupId:i,position:s,tickFormatter:o,domain:a,hide:r})})),o()(vis_TimeseriesVisualization,"getAxisScaleType",(e=>"log"===Object(r.get)(e,"axis_scale")?c.ScaleType.Log:c.ScaleType.Linear)),o()(vis_TimeseriesVisualization,"getTickFormatter",((e,t)=>Object(d.a)(Object(r.get)(e,"formatter"),Object(r.get)(e,"value_template"),t)))},53:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const s=["#68BC00","#009CE0","#B0BC00","#16A5A5","#D33115","#E27300","#FCC400","#7B64FF","#FA28FF","#333333","#808080","#194D33","#0062B1","#808900","#0C797D","#9F0500","#C45100","#FB9E00","#653294","#AB149E","#0F1419","#666666"]},54:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i(55),o=i.n(s);const a=e=>{let t=new o.a(e);const i=t.hsl().object();return i.l-=100*t.luminosity(),t=o.a.hsl(i),t.rgb().toString()}},61:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i(73),o=i.n(s),a=i(7),r=i(42);function n(e,t={},i={},s={}){try{const a=o.a.compile(e.split(r.a).join(`[${r.a}]`),{strict:!0,knownHelpersOnly:!0,...s});return a({...i,args:t})}catch(t){if(-1!==t.toString().indexOf("Parse error"))return e;if(-1!==t.message.indexOf("not defined in")){const e=t.message.split(/"/)[1];t.error={caused_by:{reason:a.i18n.translate("visTypeTimeseries.replaceVars.errors.unknownVarDescription",{defaultMessage:"{badVar} is an unknown variable",values:{badVar:"{{"+e+"}}"}}),title:a.i18n.translate("visTypeTimeseries.replaceVars.errors.unknownVarTitle",{defaultMessage:"Error processing your markdown"})}}}else t.error={caused_by:{reason:a.i18n.translate("visTypeTimeseries.replaceVars.errors.markdownErrorDescription",{defaultMessage:"Please verify you are only using markdown, known variables, and built-in Handlebars expressions"}),title:a.i18n.translate("visTypeTimeseries.replaceVars.errors.markdownErrorTitle",{defaultMessage:"Error processing your markdown"})}};return t}}},74:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i(2),o=i(54),a=i(53),r=i(42);const n=({seriesById:e,seriesName:t,seriesId:i,baseColor:n,seriesPalette:c,palettesRegistry:l,syncColors:d})=>{if(!c)return null;const u=c.name===s.d.RAINBOW||c.name===s.d.GRADIENT?"custom":c.name,m=c.name===s.d.GRADIENT?{...c.params,colors:[n,Object(o.a)(n)],gradient:!0}:c.name===s.d.RAINBOW?{...c.params,colors:a.a}:c.params;return null==l?void 0:l.get(u||"default").getCategoricalColor([{name:Object(r.b)(t),rankAtDepth:e.findIndex((({id:e})=>e===i)),totalSeriesAtDepth:e.length}],{maxDepth:1,totalSeries:e.length,behindText:!1,syncColors:d},m)}}}]);
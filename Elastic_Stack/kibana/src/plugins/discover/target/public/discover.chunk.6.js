(window.discover_bundle_jsonpfunction=window.discover_bundle_jsonpfunction||[]).push([[6],{268:function(e,t,s){"use strict";s.r(t),s.d(t,"SavedSearchEmbeddable",(function(){return saved_search_embeddable_SavedSearchEmbeddable}));var i=s(0),r=s.n(i),o=s(5),a=s.n(o),n=s(33),c=s.n(n),l=s(2),u=s(15),h=s(10),d=s(45),p=s(11),b=s(7),g=s(49),S=s.n(g),m=s(24),v=s(12),j=s(71),x=s(3),O=s(6);const P=({totalHitCount:e})=>Object(O.jsx)(v.EuiText,{grow:!1,size:"s",style:{paddingRight:2}},Object(O.jsx)(m.FormattedMessage,{id:"discover.docTable.totalDocuments",defaultMessage:"{totalDocuments} documents",values:{totalDocuments:Object(O.jsx)("strong",null,e)}})),f=a.a.memo((e=>Object(O.jsx)(j.a,e)));function C(e){const[t,s]=Object(o.useState)(void 0);return Object(O.jsx)(m.I18nProvider,null,Object(O.jsx)(v.EuiFlexGroup,{style:{width:"100%"},direction:"column",gutterSize:"xs",responsive:!1},0!==e.totalHitCount&&Object(O.jsx)(v.EuiFlexItem,{grow:!1,style:{alignSelf:"flex-end"}},Object(O.jsx)(P,{totalHitCount:e.totalHitCount})),Object(O.jsx)(v.EuiFlexItem,{style:{minHeight:0}},Object(O.jsx)(f,S()({},e,{setExpandedDoc:s,expandedDoc:t,services:Object(x.e)()})))))}s(69);var E=s(9);const T={marginLeft:"auto",marginRight:s(31).euiLightVars.euiSizeL},F=({pageSize:e,pageCount:t,activePage:s,onPageSizeChange:i,onPageClick:r})=>{const[a,n]=Object(o.useState)(!1),c=l.i18n.translate("discover.docTable.rows",{defaultMessage:"rows"}),u=()=>n(!1),h=[25,50,100].map((t=>{return Object(O.jsx)(v.EuiContextMenuItem,{key:`${t} rows`,icon:(s=t,s===e?"check":"empty"),onClick:()=>{u(),i(t)}},t," ",c);var s}));return Object(O.jsx)(v.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(O.jsx)(v.EuiFlexItem,{grow:!1},Object(O.jsx)(v.EuiPopover,{button:Object(O.jsx)(v.EuiButtonEmpty,{size:"xs",color:"text",iconType:"arrowDown",iconSide:"right",onClick:()=>n((e=>!e))},Object(O.jsx)(m.FormattedMessage,{id:"discover.docTable.rowsPerPage",defaultMessage:"Rows per page: {pageSize}",values:{pageSize:e}})),isOpen:a,closePopover:u,panelPaddingSize:"none"},Object(O.jsx)(v.EuiContextMenuPanel,{items:h}))),Object(O.jsx)(v.EuiFlexItem,{grow:!1,style:T},Object(O.jsx)(v.EuiPagination,{"aria-label":l.i18n.translate("discover.docTable.documentsNavigation",{defaultMessage:"Documents navigation"}),pageCount:t,activePage:s,onPageClick:r,compressed:!0})))};var I=s(72);const w=Object(o.memo)(I.a),R=e=>{const t=Object(o.useRef)(null),{currentPage:s,pageSize:i,totalPages:r,startIndex:a,hasNextPage:n,changePage:c,changePageSize:l}=(({totalItems:e})=>{const[t,s]=Object(o.useState)(50),[i,r]=Object(o.useState)(0),a=Object(o.useMemo)((()=>{const s=Math.ceil(e/t);return{totalPages:s,startIndex:t*i,hasNextPage:i+1<s}}),[i,t,e]),n=Object(o.useCallback)((e=>r(e)),[]),c=Object(o.useCallback)((e=>s(e)),[]);return{...a,currentPage:i,pageSize:t,changePage:n,changePageSize:c}})({totalItems:e.rows.length}),u=0!==r,h=Object(o.useCallback)((()=>{t.current&&t.current.scrollTo(0,0)}),[]),d=Object(o.useMemo)((()=>e.rows.slice(a,i+a)),[i,a,e.rows]),p=Object(o.useCallback)((e=>{h(),c(e)}),[c,h]),b=Object(o.useCallback)((e=>{h(),l(e)}),[l,h]);Object(o.useEffect)((()=>{r<s+1&&p(0)}),[s,r,p]);const g=Object(o.useMemo)((()=>!n&&e.rows.length<e.totalHitCount),[n,e.rows.length,e.totalHitCount]),j=Object(o.useMemo)((()=>Object(x.e)().uiSettings.get(E.SAMPLE_SIZE_SETTING,500)),[]),f=Object(o.useCallback)((e=>Object(O.jsx)("div",{className:"kbnDocTable__container"},Object(O.jsx)("table",{className:"kbnDocTable table","data-test-subj":"docTable"},Object(O.jsx)("thead",null,e.renderHeader()),Object(O.jsx)("tbody",null,e.renderRows(d))))),[d]);return Object(O.jsx)(v.EuiFlexGroup,{style:{width:"100%"},direction:"column",gutterSize:"xs",responsive:!1},Object(O.jsx)(v.EuiFlexItem,{grow:!1},Object(O.jsx)(v.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"xs",responsive:!1,wrap:!0},g&&Object(O.jsx)(v.EuiFlexItem,{grow:!1},Object(O.jsx)(v.EuiText,{grow:!1,size:"s",color:"subdued"},Object(O.jsx)(m.FormattedMessage,{id:"discover.docTable.limitedSearchResultLabel",defaultMessage:"Limited to {resultCount} results. Refine your search.",values:{resultCount:j}}))),0!==e.totalHitCount&&Object(O.jsx)(v.EuiFlexItem,{grow:!1,"data-test-subj":"toolBarTotalDocsText"},Object(O.jsx)(P,{totalHitCount:e.totalHitCount})))),Object(O.jsx)(v.EuiFlexItem,{style:{minHeight:0}},Object(O.jsx)(w,S()({ref:t},e,{render:f}))),u&&Object(O.jsx)(v.EuiFlexItem,{grow:!1},Object(O.jsx)(F,{pageSize:i,pageCount:r,activePage:s,onPageClick:p,onPageSizeChange:b})))};function _(e){return Object(O.jsx)(m.I18nProvider,null,Object(O.jsx)(R,{columns:e.columns,rows:e.rows,totalHitCount:e.totalHitCount,indexPattern:e.indexPattern,onSort:e.onSort,onAddColumn:e.onAddColumn,onMoveColumn:e.onMoveColumn,onRemoveColumn:e.onRemoveColumn,sort:e.sort,onFilter:e.onFilter,useNewFieldsApi:e.useNewFieldsApi,searchDescription:e.searchDescription,sharedItemTitle:e.sharedItemTitle,isLoading:e.isLoading,dataTestSubj:"embeddedSavedSearchDocTable"}))}const y=a.a.memo(_),A=a.a.memo(C);function D({searchProps:e,useLegacyTable:t,refs:s}){if(t){const t={...e,refs:s};return Object(O.jsx)(y,t)}const i=e;return Object(O.jsx)(A,S()({},i,{className:"dscDiscoverGrid"}))}var M=s(74),L=s(67),z=s(50);class saved_search_embeddable_SavedSearchEmbeddable extends h.Embeddable{constructor({savedSearch:e,editUrl:t,editPath:s,indexPatterns:i,editable:o,filterManager:a,services:n},c,u,h){super(c,{defaultTitle:e.title,editUrl:t,editPath:s,editApp:"discover",indexPatterns:i,editable:o},h),r()(this,"savedSearch",void 0),r()(this,"inspectorAdapters",void 0),r()(this,"panelTitle",""),r()(this,"filtersSearchSource",void 0),r()(this,"subscription",void 0),r()(this,"type",p.a),r()(this,"filterManager",void 0),r()(this,"abortController",void 0),r()(this,"services",void 0),r()(this,"prevTimeRange",void 0),r()(this,"prevFilters",void 0),r()(this,"prevQuery",void 0),r()(this,"prevSearchSessionId",void 0),r()(this,"searchProps",void 0),r()(this,"node",void 0),r()(this,"fetch",(async()=>{const e=this.input.searchSessionId,t=!this.services.uiSettings.get(E.SEARCH_FIELDS_FROM_SOURCE,!1);if(!this.searchProps)return;const{searchSource:s}=this.savedSearch;this.abortController&&this.abortController.abort(),this.abortController=new AbortController,((e,t,s,i,r)=>{const{sampleSize:o,defaultSort:a}=r;if(e.setField("size",o),e.setField("sort",Object(z.c)(s,t,a)),i){e.removeField("fieldsFromSource");const t={field:"*",include_unmapped:"true"};e.setField("fields",[t])}else e.removeField("fields")})(s,this.searchProps.indexPattern,this.searchProps.sort,t,{sampleSize:this.services.uiSettings.get(E.SAMPLE_SIZE_SETTING),defaultSort:this.services.uiSettings.get(E.SORT_DEFAULT_ORDER_SETTING)}),this.inspectorAdapters.requests.reset(),this.searchProps.isLoading=!0,this.updateOutput({loading:!0,error:void 0});const i={type:this.type,name:"discover",id:this.savedSearch.id,description:this.output.title||this.output.defaultTitle||"",url:this.output.editUrl,parent:this.input.executionContext};try{const{rawResponse:t}=await s.fetch$({abortSignal:this.abortController.signal,sessionId:e,inspector:{adapter:this.inspectorAdapters.requests,title:l.i18n.translate("discover.embeddable.inspectorRequestDataTitle",{defaultMessage:"Data"}),description:l.i18n.translate("discover.embeddable.inspectorRequestDescription",{defaultMessage:"This request queries Elasticsearch to fetch the data for the search."})},executionContext:i}).toPromise();this.updateOutput({loading:!1,error:void 0}),this.searchProps.rows=t.hits.hits,this.searchProps.totalHitCount=t.hits.total,this.searchProps.isLoading=!1}catch(e){this.destroyed||(this.updateOutput({loading:!1,error:e}),this.searchProps.isLoading=!1)}})),this.executeTriggerActions=u,this.services=n,this.filterManager=a,this.savedSearch=e,this.inspectorAdapters={requests:new d.RequestAdapter},this.initializeSearchEmbeddableProps(),this.subscription=this.getUpdated$().subscribe((()=>{this.panelTitle=this.output.title||"",this.searchProps&&this.pushContainerStateParamsToProps(this.searchProps)}))}initializeSearchEmbeddableProps(){const{searchSource:e}=this.savedSearch,t=e.getField("index");if(!t)return;this.savedSearch.sort&&this.savedSearch.sort.length||(this.savedSearch.sort=Object(z.a)(t,this.services.uiSettings.get(E.SORT_DEFAULT_ORDER_SETTING,"desc")));const s={columns:this.savedSearch.columns,indexPattern:t,isLoading:!1,sort:Object(z.a)(t,this.services.uiSettings.get(E.SORT_DEFAULT_ORDER_SETTING,"desc")),rows:[],searchDescription:this.savedSearch.description,description:this.savedSearch.description,inspectorAdapters:this.inspectorAdapters,searchTitle:this.savedSearch.title,services:this.services,onAddColumn:e=>{if(!s.columns)return;const t=M.a(s.columns,e,!0);this.updateInput({columns:t})},onRemoveColumn:e=>{if(!s.columns)return;const t=M.d(s.columns,e,!0);this.updateInput({columns:t})},onMoveColumn:(e,t)=>{if(!s.columns)return;const i=M.c(s.columns,e,t);this.updateInput({columns:i})},onSetColumns:e=>{this.updateInput({columns:e})},onSort:e=>{const t=[];e.forEach((e=>{t.push(e)})),this.updateInput({sort:t})},sampleSize:500,onFilter:async(e,s,i)=>{let r=b.esFilters.generateFilters(this.filterManager,e,s,i,t.id);r=r.map((e=>({...e,$state:{store:b.esFilters.FilterStateStore.APP_STATE}}))),await this.executeTriggerActions(b.APPLY_FILTER_TRIGGER,{embeddable:this,filters:r})},useNewFieldsApi:!this.services.uiSettings.get(E.SEARCH_FIELDS_FROM_SOURCE,!1),showTimeCol:!this.services.uiSettings.get(E.DOC_HIDE_TIME_COLUMN_SETTING,!1),ariaLabelledBy:"documentsAriaLabel"},i=e.create();i.setField("filter",(()=>{if(this.searchProps&&this.input.timeRange)return this.services.timefilter.createFilter(t,this.input.timeRange)})),this.filtersSearchSource=e.create(),this.filtersSearchSource.setParent(i),e.setParent(this.filtersSearchSource),this.pushContainerStateParamsToProps(s),s.isLoading=!0,this.savedSearch.grid&&(s.settings=this.savedSearch.grid)}async pushContainerStateParamsToProps(e,{forceFetch:t=!1}={forceFetch:!1}){var s;const i=!(b.esFilters.onlyDisabledFiltersChanged(this.input.filters,this.prevFilters)&&Object(u.isEqual)(this.prevQuery,this.input.query)&&Object(u.isEqual)(this.prevTimeRange,this.input.timeRange)&&Object(u.isEqual)(e.sort,this.input.sort||this.savedSearch.sort)&&this.prevSearchSessionId===this.input.searchSessionId);e.columns=Object(L.a)({columns:this.input.columns||this.savedSearch.columns},this.services.core.uiSettings).columns;const r=this.savedSearch.sort&&this.savedSearch.sort.length?this.savedSearch.sort:Object(z.a)(null===(s=this.searchProps)||void 0===s?void 0:s.indexPattern,Object(x.e)().uiSettings.get(E.SORT_DEFAULT_ORDER_SETTING,"desc"));var o,a;(e.sort=this.input.sort||r,e.sharedItemTitle=this.panelTitle,t||i)?(this.filtersSearchSource.setField("filter",this.input.filters),this.filtersSearchSource.setField("query",this.input.query),null!==(o=this.input.query)&&void 0!==o&&o.query||null!==(a=this.input.filters)&&void 0!==a&&a.length?this.filtersSearchSource.setField("highlightAll",!0):this.filtersSearchSource.removeField("highlightAll"),this.prevFilters=this.input.filters,this.prevQuery=this.input.query,this.prevTimeRange=this.input.timeRange,this.prevSearchSessionId=this.input.searchSessionId,this.searchProps=e,await this.fetch()):this.searchProps&&this.node&&(this.searchProps=e);this.node&&this.renderReactComponent(this.node,this.searchProps)}async render(e){if(!this.searchProps)throw new Error("Search props not defined");this.node&&c.a.unmountComponentAtNode(this.node),this.node=e}renderReactComponent(e,t){if(!this.searchProps)return;const s={searchProps:t,useLegacyTable:this.services.uiSettings.get(E.DOC_TABLE_LEGACY),refs:e};c.a.render(Object(O.jsx)(D,s),e)}reload(){this.searchProps&&this.pushContainerStateParamsToProps(this.searchProps,{forceFetch:!0})}getSavedSearch(){return this.savedSearch}getInspectorAdapters(){return this.inspectorAdapters}getDescription(){return this.savedSearch.description}destroy(){var e;super.destroy(),this.searchProps&&delete this.searchProps,null===(e=this.subscription)||void 0===e||e.unsubscribe(),this.abortController&&this.abortController.abort()}}}}]);